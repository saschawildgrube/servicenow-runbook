<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_snc_run_book.HtmlRenderRunbook</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>Renders an operations runbook for the instance.</description>
        <name>HtmlRenderRunbook</name>
        <script><![CDATA[function HtmlRenderRunbook()
{
	var GetStringValue = x_snc_devtools.GetStringValue;
	var HtmlRenderLink = x_snc_devtools.HtmlRenderLink;
	var HtmlRenderError = x_snc_devtools.HtmlRenderError;
	var GetInstanceURL = x_snc_devtools.GetInstanceURL;
	var HtmlRenderTable = x_snc_devtools.HtmlRenderTable;
	var HtmlRenderStyle = x_snc_devtools.HtmlRenderStyle;
	var DocumentationAPI = x_snc_devtools.DocumentationAPI;
	var RenderValue = x_snc_devtools.RenderValue;
	var GetBoolValue = x_snc_devtools.GetBoolValue;
	var GetInstanceRecordURL = x_snc_devtools.GetInstanceRecordURL;
	
	var strHtml = '';
	
	if (IsActive() == false)
	{
		return HtmlRenderError('Runbook is turned off.');
	}
	
	
	// STYLES
	strHtml += HtmlRenderStyle('table.runbook, th.runbook, td.runbook { border: 1px solid; padding: 2px; vertical-align: top }');
	
	// HEADER
	strHtml += '<h1>Runbook</h1>';
	
	// INSTANCE INFORMATION
	
	strHtml += '<p>Instance: '+HtmlRenderLink(GetInstanceURL(),GetInstanceURL(),true)+'</p>';
	
	// TOC
	
	
	// TECHNICAL USERS
	strHtml += '<h2>Technical Users</h2>'
	
	var grUser = new GlideRecord('sys_user');
	grUser.addQuery('active','=','true');
	var condition = grUser.addQuery('web_service_access_only','=',true);
	condition.addOrCondition('internal_integration_user','=','true');
	grUser.orderBy('user_name');
	grUser.query();
	if (grUser.getRowCount() == 0)
	{
		strHtml += '<p>There are no active technical users.</p>';
	}
	var aUserTable = [];
	var aUserTableHeader = [];
	aUserTableHeader.push({ header: true, content: 'User ID'} );
	aUserTableHeader.push({ header: true, content: 'Name'} );
	aUserTableHeader.push({ header: true, content: 'Integration'} );
	aUserTableHeader.push({ header: true, content: 'Web Service Only'} );
	aUserTable.push(aUserTableHeader);
	while (grUser.next())
	{
		var aUserRow = [];
		var strUserUrl = GetInstanceRecordURL('sys_user',grUser.sys_id);
		var strUserLink = HtmlRenderLink(strUserUrl,grUser.user_name,true);
		aUserRow.push(strUserLink);
		aUserRow.push(GetStringValue(grUser.getDisplayValue()));
		aUserRow.push(RenderValue(GetBoolValue(grUser.internal_integration_user)));
		aUserRow.push(RenderValue(GetBoolValue(grUser.web_service_access_only)));
		aUserTable.push(aUserRow);
	}
	
	strHtml += HtmlRenderTable(aUserTable,'runbook');
	
	// APPS
	strHtml += '<h2>Applications</h2>';
	
	var grApp = new GlideRecord('sys_app');
	grApp.orderBy('name');
	grApp.query();

	/*
	strHtml += '<table border="2"><tbody>';
	
	strHtml += '<tr>';
		strHtml += '<th>Name</th>';
		strHtml += '<th>Version</th>';
		strHtml += '<th>Scope</th>';
		strHtml += '<th>Maintainer</th>';
		strHtml += '<th>Description</th>';
		strHtml += '<th>Documentation</th>';
	strHtml += '</tr>';
*/

	var aAppTable = [];
	
	var aHeaderRow = [];
	aHeaderRow.push({ header: true, content: 'Name'} );
	aHeaderRow.push({ header: true, content: 'Version'} );
	aHeaderRow.push({ header: true, content: 'Scope'} );
	aHeaderRow.push({ header: true, content: 'Maintainer'} );
	aHeaderRow.push({ header: true, content: 'Description'} );
	aHeaderRow.push({ header: true, content: 'Links'} );
	
	aAppTable.push(aHeaderRow);
	
	while (grApp.next())
	{
		var aRow = [];
		/*
		strHtml += '<tr>';
		
		strHtml += '<td>'+grApp.name+'</td>';
		strHtml += '<td>'+grApp.version+'</td>';
		strHtml += '<td>'+grApp.scope+'</td>';
		*/
		
		aRow.push(GetStringValue(grApp.name));
		aRow.push(GetStringValue(grApp.version));
		aRow.push(GetStringValue(grApp.scope));
		
		var strMaintainer = GetStringValue(grApp.x_snc_devtools_maintainer);
		if (GetStringValue(grApp.x_snc_devtools_maintainer_email) != '')
		{
			strMaintainer += '<br/>' + HtmlRenderLink(grApp.x_snc_devtools_maintainer_email,grApp.x_snc_devtools_maintainer_email,true); 
		}
		
		aRow.push(strMaintainer);
		//strHtml += '<td>'+strMaintainer+'</td>';

		aRow.push(GetStringValue(grApp.short_description));
		//strHtml += '<td>' + grApp.short_description+'</td>';
		
		var strLinks = '';
		var strDocUrl = GetStringValue(grApp.x_snc_devtools_documentation_url);
		if (strDocUrl != '')
		{
			strLinks = HtmlRenderLink(strDocUrl,'Docs',true);
		}
		aRow.push(strLinks);
		//strHtml += '<td>'+strDocumentation+'</td>';
		
		//strHtml += '</tr>';
		
		aAppTable.push(aRow);
	}
	
	//strHtml += '</tbody></table>';
	
	strHtml += HtmlRenderTable(aAppTable,'runbook');
	
	
	var grApp = new GlideRecord('sys_app');
	grApp.orderBy('name');
	grApp.query();

	while (grApp.next())
	{
		strHtml += '<h3>'+grApp.name+'</h3>';
		var docapi = new DocumentationAPI(grApp.sys_id);

		strHtml += '<h4>Roles</h4>';
		strHtml += docapi.RenderRoles();
	
		
		strHtml += '<h4>System Properties</h4>';
		strHtml += docapi.RenderProperties();
		
	}
	
	return strHtml;
}]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-11-08 14:30:40</sys_created_on>
        <sys_id>c78f2ca9db8399106a03dad1f39619f3</sys_id>
        <sys_mod_count>29</sys_mod_count>
        <sys_name>HtmlRenderRunbook</sys_name>
        <sys_package display_value="Runbook WORK IN PROGRESS" source="x_snc_run_book">f07a2ce1db8399106a03dad1f39619d6</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Runbook WORK IN PROGRESS">f07a2ce1db8399106a03dad1f39619d6</sys_scope>
        <sys_update_name>sys_script_include_c78f2ca9db8399106a03dad1f39619f3</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2022-11-10 11:12:58</sys_updated_on>
    </sys_script_include>
</record_update>
